{"tags":[{"name":"javascript","permalink":"https://egoist.moe/tags/javascript/","url":"/async/tags/javascript.json","count":8},{"name":"node.js","permalink":"https://egoist.moe/tags/node-js/","url":"/async/tags/node.js.json","count":2},{"name":"sindresorhus","permalink":"https://egoist.moe/tags/sindresorhus/","url":"/async/tags/sindresorhus.json","count":1}],"categories":[],"url":"/async/posts/2016/01/29/node-js-module-style-guide.json","date":1454031870000,"path":{"year":2016,"month":1,"day":29,"name":"node-js-module-style-guide"},"subtitle":"ç¼–å†™é«˜è´¨é‡ã€å¯å¤ç”¨çš„ Node.js æ¨¡å—","title":"Node.js æ¨¡å—é£æ ¼æŒ‡å—","permalink":"https://egoist.moe/2016/01/29/node-js-module-style-guide/","content":"<p>JavaScript ä»£ç ä¸€å‘çš„ç‰¹ç‚¹å°±æ˜¯éš¾ä»¥ç»´æŠ¤ï¼Œä¿æŒä¸€ä¸ªè‰¯å¥½çš„ä»£ç ã€ç»„ç»‡é£æ ¼æœ‰åŠ©äºæå‡æ•ˆç‡ã€é‡æ„ä»£ç ã€æ·»åŠ æ–°åŠŸèƒ½ã€å•å…ƒæµ‹è¯•ç­‰ç­‰ã€‚</p>\n<p>æˆ‘æ€»ç»“äº†ä¸€ä¸‹å†™äº† 200 ä¸ª NPM package ä¹‹åçš„ä¸€äº›ä¸ªäººç»éªŒå’Œä¹ æƒ¯ã€‚</p>\n<h2><span>åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®</span></h2>\n<p>ä¸å†ä½¿ç”¨ <code>npm init</code>ã€‚å› ä¸ºé™¤äº† <code>package.json</code> è¿˜æœ‰ä¸€äº›é¢å¤–çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ <code>circle.yml</code>ã€<code>.editorconfig</code>ã€<code>LICENSE</code> ã€<code>README.md</code> ç­‰ç­‰ã€‚</p>\n<p>ä½¿ç”¨ <a href=\"http://yeoman.io\" target=\"_blank\" rel=\"external\">yeoman</a>ã€‚å¦‚æœä½ å–œæ¬¢åœ¨ä»£ç ä¸­ä½¿ç”¨åˆ†å·å’Œç”¨ travis æ¥æµ‹è¯•ï¼Œæ¨è <a href=\"https://github.com/sindresorhus\" target=\"_blank\" rel=\"external\">sindresorhus</a> ç”¨çš„ <a href=\"https://github.com/sindresorhus/generator-nm\" target=\"_blank\" rel=\"external\">generator-nm</a>ã€‚å¦‚æœä½ ä¸å–œæ¬¢åˆ†å·å¹¶ä¸”ç”¨ circle æ¥æµ‹è¯•ï¼Œæ¨èæˆ‘ç”¨çš„ <a href=\"https://github.com/egoist/generator-esnm\" target=\"_blank\" rel=\"external\">generator-esnm</a>ã€‚</p>\n<p>æƒ³è¦å®šåˆ¶ä½ çš„ <a href=\"http://README.md\" target=\"_blank\" rel=\"external\">README.md</a> ? <a href=\"https://github.com/IonicaBizau/blah\" target=\"_blank\" rel=\"external\">blah</a> å¯ä»¥ä¸ºä½ å®šåˆ¶ç”Ÿæˆ <a href=\"http://README.md\" target=\"_blank\" rel=\"external\">README.md</a> ä»¥åŠæ›´å¤šæå‡æ•ˆç‡çš„åŠŸèƒ½ã€‚</p>\n<h2><span>æ³¨é‡Š</span></h2>\n<p>æ¯ä¸€ä¸ªå…·æœ‰å•ç‹¬æ„ä¹‰çš„ä»£ç ç‰‡æ®µå‰éƒ½æ¨èå†™æ³¨é‡Šï¼Œå°±ç®—å†ç®€å•çš„ä»£ç ä½ éš”å‡ å¤©çœ‹ä¹Ÿä¸å¯èƒ½ä¸€ç§’çœ‹å‡ºå®ƒåœ¨å¹²ä»€ä¹ˆï¼Œè€Œæœ‰äº†æ³¨é‡Šå°±å¯ä»¥ã€‚å¯¹äºå¤æ‚ä¸”æ„ä¹‰é‡å¤§çš„ä»£ç å°½é‡å†™å®Œæ•´çš„ jsdoc æ¥è¯´æ˜ã€‚</p>\n<p>å¦ä¸€ä¸ªåŸå› å°±æ˜¯è¿™æ ·å¯ä»¥è®©ä½ çš„ä»£ç æ˜¾å¾—æ›´æ ¼å¼åŒ–ï¼Œä»£ç æŒ¤åœ¨ä¸€å †å¾ˆå‚»ä¸”ä¸ç¾è§‚ã€‚è€Œä¸”ä½ ä¹Ÿå¯ä»¥è‡ªåŠ¨ä»ä½ ä»£ç çš„ jsdoc ç”Ÿæˆ api docï¼</p>\n<pre><code class=\"language-js\">/**\t\n * Module dependencies\n */\nconst path = require('path')\n\n/**\n * Reverse array but not change itself\n *\n * @param {Array} names\n * @return {Array}\n */\nfunction rev(names) {\n\treturn names.concat().reverse()\n}\n</code></pre>\n<h2><span>ç¼–å†™å¯å¤ç”¨æ¨¡å—</span></h2>\n<p>å¯¹äºä¸€ä¸ªé¡¹ç›®ä¸­å¤šæ¬¡ä½¿ç”¨ï¼ˆ&gt;1ï¼‰çš„ä»£ç ï¼Œæ¨èæ”¾å…¥å•ç‹¬çš„æ–‡ä»¶ä½œä¸ºæ¨¡å—ä½¿ç”¨ã€‚<br>\nå¯¹äºæ›´ä¸ºé€šç”¨çš„ä»£ç å°½é‡æ‰“åŒ…è¿›ä¸€ä¸ªå•ç‹¬çš„ npm module æ¥ä½¿ç”¨ã€‚</p>\n<h2><span>ä»£ç é£æ ¼æŒ‡å—</span></h2>\n<p>å¯¹äºåˆ†å·çš„é—®é¢˜ä¸ä½œè®¨è®ºï¼ŒåŠ ä¸åŠ éƒ½è¡Œã€‚</p>\n<p>å¯¹äºå¼‚æ­¥ä»£ç ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ callback è€Œæ˜¯æ”¹æˆ Promiseï¼Œå¹¶ä¸”æŠŠ HTTP è¯·æ±‚å°è£…è¿›å•ç‹¬çš„æ¨¡å—ï¼Œè¿™æ ·æ›´æ–¹ä¾¿é…åˆ <a href=\"https://github.com/tj/co\" target=\"_blank\" rel=\"external\">co</a> æ¥ä½¿ç”¨ã€‚</p>\n<pre><code class=\"language-js\">// fetchData.js\n// è€å¼å›è°ƒé£æ ¼\nconst request = require('superagent')\n\nmodule.exports = function (callback) {\n\trequest\n\t\t.get('xxx.json')\n\t\t.end((err, res) =&gt; {\n\t\t\tcallback(res)\n\t\t})\n}\n// app.js\n// è°ƒç”¨å®ƒ\nconst fetchData = require('./fetchData')\n\nmodule.exports = function () {\n\tfetchData(data =&gt; {\n\t\tconsole.log(data)\n\t})\n}\n\n// fetchData.js\n// æ— é˜»å¡åŒæ­¥ä»£ç é£æ ¼\nconst fetch = require('node-fetch')\n\nmodule.exports = co.wrap(function* () {\n\tconst data = yield fetch('xxx.json')\n\t\t.then(data =&gt; data.json())\n\treturn data\n})\n// app.js\n// è°ƒç”¨å®ƒ\nconst fetchData = require('./fetchData')\n\nmodule.exports = co.wrap(function* () {\n\tconst data = yield fetchData()\n\tconsole.log(data)\n})\n</code></pre>\n<p><strong>è¿˜ä½¿ç”¨ co? ä¸æ˜¯æœ‰ async/await å—?</strong></p>\n<p>åœ¨ async/await æ²¡è¢« v8 å¼•æ“å®ç°ä¹‹å‰ç”¨ co éƒ½è¿˜æ˜¯ç¬¬ä¸€é€‰æ‹©ï¼Œé™¤éæŸäº›æƒ…å†µä½ ä½¿ç”¨äº† babel é‚£ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨ async/awaitã€‚ä¸è¿‡å³ä½¿ç°åœ¨ç”¨ co åœ¨å°†æ¥ async/await api è¢«å®ç°çš„æ—¶å€™ä¹Ÿèƒ½è½»æ¾åœ°è¿ç§»è¿‡å»ã€‚</p>\n<blockquote>\n<p>co is a stepping stone towards ES7 async/await â€“ TJ Holowaychuk</p>\n</blockquote>\n<h2><span>ESLint</span></h2>\n<p>ä¿æŒè‰¯å¥½ä»£ç é£æ ¼çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ lint ä½ çš„ä»£ç ï¼Œé€‰æ‹©ä½ ä¹ æƒ¯çš„ä»£ç é£æ ¼ï¼Œç”¨ç¼–è¾‘å™¨å®æ—¶ lint æˆ–è€…æ·»åŠ ä¸€äº› git hook åœ¨ commit çš„æ—¶å€™ lint ä¹Ÿå¯ä»¥ã€‚</p>\n<p>æˆ‘ç›®å‰ä½¿ç”¨ <a href=\"https://github.com/sindresorhus/xo\" target=\"_blank\" rel=\"external\">xo</a> æ¥æ£€æµ‹ä»£ç ï¼Œå®ƒé»˜è®¤æ— éœ€é…ç½®ä½†ä½ å¯ä»¥æ ¹æ®ä½ çš„å–œå¥½è°ƒæ•´ï¼ŒåŸºäº ESLint ã€‚å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé£æ ¼ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ ESlint ä¸­ä½¿ç”¨å®ƒçš„<a href=\"https://github.com/sindresorhus/eslint-config-xo\" target=\"_blank\" rel=\"external\">é…ç½®æ–‡ä»¶</a>ã€‚</p>\n<h2><span>æµ‹è¯•</span></h2>\n<p>å†™æµ‹è¯•æ˜¯å¾ˆæœ‰è¶£çš„ï¼Œå½“ä¸”ä»…å½“ä½ ç”¨ <a href=\"https://github.com/sindresorhus/ava\" target=\"_blank\" rel=\"external\">AVA</a> çš„æ—¶å€™ã€‚</p>\n<p><img src=\"https://camo.githubusercontent.com/fc55513ee5cb412b2b0d1540032b602ed0142dbe/68747470733a2f2f63646e2e7261776769742e636f6d2f73696e647265736f726875732f6176612f666531636561316361336432633835313863306363333965633862653539326265616239303535382f6d656469612f6c6f676f2e737667\" alt=\"ava\"></p>\n<p>æˆ‘ä½¿ç”¨ AVA çš„ä¸»è¦åŸå› æ˜¯:</p>\n<ul>\n<li>å¾ˆå¿«</li>\n<li>è¯­æ³•ç®€æ´</li>\n<li>å†…ç½® ES2015/2016</li>\n<li>many moreâ€¦</li>\n</ul>\n<h2><span>Commit</span> é£æ ¼</h2>\n<p>ä¸ä½¿ç”¨æ²¡æœ‰æ„ä¹‰çš„ Commit ä¿¡æ¯ï¼Œæ¯”å¦‚å•çº¯åªå†™ä¸ª <code>fix</code>ã€<code>update</code>ã€<code>change</code>ã€‚</p>\n<p>å°½é‡æè¿°ä½ å¹²äº†ä»€ä¹ˆäº‹:</p>\n<pre><code class=\"language-bash\">git commit -m &quot;fix tweak on ie9&quot;\ngit commit -m &quot;release 0.0.1&quot;\ngit commit -m &quot;refactor to use es2015&quot;\ngit commit -m &quot;ğŸ”¥&quot;\n</code></pre>\n<p>æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ <a href=\"https://github.com/commitizen/cz-cli\" target=\"_blank\" rel=\"external\">commitizen</a> æ¥è§„èŒƒä½ çš„ commit message æ ¼å¼ã€‚</p>\n<p><img src=\"https://github.com/commitizen/cz-cli/raw/master/meta/screenshots/add-commit.png\" alt=\"commitizen\"></p>\n<h2><span>Semantic-Release</span></h2>\n<p>å‘å¸ƒ NPM æ¨¡å—æ˜¯å¾ˆè®©äººå›°æ‰°çš„ä¸€æ­¥ï¼Œä½ éœ€è¦æ‰‹åŠ¨ bump versionï¼Œéœ€è¦æ‰§è¡Œ <code>npm test</code> æ¥çœ‹æ˜¯å¦æœ‰é”™ï¼Œç„¶åå†æ‰‹åŠ¨æ‰§è¡Œ <code>npm publish</code>ï¼Œè¿™äº›æ­¥éª¤å¯ä»¥è¢«è§„èŒƒä¸”è‡ªåŠ¨åŒ–ã€‚</p>\n<p>ä½¿ç”¨ <a href=\"https://github.com/semantic-release/semantic-release\" target=\"_blank\" rel=\"external\">semantic-release</a> å¯ä»¥è‡ªåŠ¨åˆ†æä½ çš„ commit message ç„¶åæ ¹æ®è¿™äº›æ¨æµ‹ä½ çš„ä»£ç æ”¹åŠ¨æ¥è¿›è¡Œè¯­ä¹‰åŒ–çš„ç‰ˆæœ¬å·å‡çº§å¹¶è‡ªåŠ¨æ›´æ–° changelogï¼Œ<a href=\"https://github.com/egoist/tooling/releases\" target=\"_blank\" rel=\"external\">è¿™äº›</a> å°±æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p>\n<h2><span>2016</span></h2>\n<p>200 more modules? Exciting! âœ¨</p>\n"}