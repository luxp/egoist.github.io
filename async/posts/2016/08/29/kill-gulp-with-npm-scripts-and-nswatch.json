{"tags":[{"name":"gulp","permalink":"https://egoist.moe/tags/gulp/","url":"/async/tags/gulp.json","count":1},{"name":"npm","permalink":"https://egoist.moe/tags/npm/","url":"/async/tags/npm.json","count":1}],"categories":[],"url":"/async/posts/2016/08/29/kill-gulp-with-npm-scripts-and-nswatch.json","date":1472460870000,"path":{"year":2016,"month":8,"day":29,"name":"kill-gulp-with-npm-scripts-and-nswatch"},"subtitle":"Long live gulp, I use npm script","title":"ç”¨ npm scripts å’Œ nswatch æ›¿ä»£ gulp","permalink":"https://egoist.moe/2016/08/29/kill-gulp-with-npm-scripts-and-nswatch/","content":"<h2 id=\"span-ä¸ºä»€ä¹ˆç”¨-npm-scripts-span\"><span>ä¸ºä»€ä¹ˆç”¨ npm scripts ?</span></h2>\n<p>é¦–å…ˆæˆ‘è§‰å¾—  <a href=\"https://medium.freecodecamp.com/why-i-left-gulp-and-grunt-for-npm-scripts-3d6853dd22b8#.8wsejnq0u\" target=\"_blank\" rel=\"external\">Why I Left Gulp and Grunt for npm Scripts</a> é‡Œè¯´çš„ä¸ç”¨ gulp çš„ç†ç”±åŸºæœ¬æ²¡æœ‰é“ç†:</p>\n<ol>\n<li>gulp æ’ä»¶è´¨é‡ã€æ•°é‡å’Œå®æ—¶æ€§</li>\n</ol>\n<p>ä½œè€…æŠ±æ€¨ gulp æ’ä»¶çš„è´¨é‡å–å†³äºæ’ä»¶ä½œè€…ï¼Œè¿™å¯ä»¥ç†è§£ï¼Œ<strong>ä½†æ˜¯ npm çš„åŒ…åŒæ ·å–å†³äºä½œè€…å•Š</strong>ã€‚</p>\n<p>ä½œè€…æŠ±æ€¨ gulp æ’ä»¶çš„æ•°é‡ä¸å¦‚ npmï¼Œ<strong>è¿™ä¸æ˜¯åºŸè¯å—</strong>ã€‚</p>\n<p>ä½œè€…æŠ±æ€¨ gulp æ’ä»¶ä¸èƒ½åŠæ—¶æ›´æ–°ï¼Œæ¯”å¦‚ babel 6 å‡çº§äº† gulp-babel å¹¶æ²¡æœ‰ç«‹åˆ»å‡çº§ã€‚<strong>åˆä¸æ˜¯çœ‹ç›´æ’­ï¼Œå¹²å˜›å®æ—¶?</strong></p>\n<ol start=\"2\">\n<li>debug å¾ˆç—›è‹¦ï¼Œgulp crash æ‰æ˜¯å› ä¸ºæŸä¸ªæ’ä»¶å—è¿˜æ˜¯å› ä¸ºç‰ˆæœ¬é—®é¢˜</li>\n</ol>\n<p>é¢ï¼Œéš¾é“ç›´æ¥ç”¨ npm package å°±æ²¡æœ‰è¿™äº›é—®é¢˜å—ã€‚</p>\n<ol start=\"3\">\n<li>ä¸è¿è´¯çš„æ–‡æ¡£ï¼Œæ¯”å¦‚ gulp-eslint å’Œ eslintï¼Œeslint çš„æ–‡æ¡£å°±æ˜¯ gulp æ’ä»¶çš„æ–‡æ¡£å¥½å¾—å¤š</li>\n</ol>\n<p>è¿™ä¸åˆæ˜¯åºŸè¯å—ï¼Œå†™ä¸ªæ’ä»¶è¿˜è¦æŠŠç”¨çš„åŒ…çš„æ–‡æ¡£é‡æ–°å†™ä¸€é?</p>\n<hr>\n<p>å¥½äº†ï¼ŒåŸæ–‡æŒ‘å‰” gulp çš„ç†ç”±å…¨è¢«æ‰³å€’äº†ï¼Œä½†æ˜¯å…¶ä¸­æ”¯æŒ npm çš„ç†ç”±å€’æ˜¯æŒºæœ‰é“ç†:</p>\n<ol>\n<li>npm scripts å¹¶ä¸éœ€è¦ä½ å¾ˆæ“…é•¿å‘½ä»¤è¡Œæ“ä½œ</li>\n</ol>\n<p>ä½ å¹¶ä¸éœ€è¦åœ¨ npm scripts é‡Œç”¨ä¸€äº›å¾ˆé«˜æ·±çš„å‘½ä»¤è¡Œï¼Œå¾ˆå¤š unix å‘½ä»¤æ˜¯éœ€è¦èŠ±å¾ˆé•¿æ—¶é—´å­¦ä¹ çš„ã€‚åƒç±»ä¼¼ rm -rf ä¹‹ç±»çš„å‘½ä»¤å¾ˆå®¹æ˜“æŒæ¡ï¼Œè€Œä¸”ä¹Ÿæœ‰ç›¸åº”çš„ npm åŒ… <a href=\"https://github.com/isaacs/rimraf\" target=\"_blank\" rel=\"external\">rimraf</a> è®©ä½ ä½¿ç”¨ï¼Œä¸”è·¨å¹³å°æ”¯æŒã€‚</p>\n<ol start=\"2\">\n<li>npm scripts ä¸å¤Ÿå¼ºå¤§å—?</li>\n</ol>\n<pre><code class=\"language-JSON\">{\n  &quot;scripts&quot;: {\n    &quot;clean&quot;: &quot;rimraf ./dist &amp;&amp; mkdir dist&quot;,\n    &quot;prebuild&quot;: &quot;npm run clean&quot;,\n    &quot;build&quot;: &quot;cross-env NODE_ENV=production webpack&quot;\n  }\n}\n</code></pre>\n<p>npm scripts ç”šè‡³æ”¯æŒ <code>pre</code> <code>post</code> è¿™äº› hook è®©ä½ åœ¨ç›¸åº”çš„ä¸€ä¸ª task ä¹‹å‰å’Œä¹‹åè°ƒç”¨ã€‚</p>\n<p>ä½ å¯ä»¥ç›´æ¥æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶æ¥å®Œæˆç›¸åº”çš„æ„å»ºå·¥ä½œï¼Œè¿™è®©ä½ å‡ ä¹èƒ½åšä»»ä½• gulp èƒ½åšçš„äº‹:</p>\n<pre><code class=\"language-JSON\">{\n  &quot;scripts&quot;: {\n    &quot;build&quot;: &quot;node build.js&quot;\n  }\n}\n</code></pre>\n<ol start=\"3\">\n<li>npm scripts ä¸æ˜¯è·¨å¹³å°çš„</li>\n</ol>\n<p>å› ä¸ºä½ å¯èƒ½ä¼šåœ¨ npm scripts é‡Œç”¨ä¸€äº› unix å‘½ä»¤ï¼Œè§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ç”¨ npm åŒ…æ›¿ä»£è¿™äº›å‘½ä»¤ã€‚</p>\n<ol start=\"4\">\n<li>å¯ç»´æŠ¤æ€§</li>\n</ol>\n<p>gulp tasks ä¹Ÿå¤šäº†ä»¥åä¼šå˜å¾—å¾ˆéš¾ç»´æŠ¤ï¼Œnpm scripts ä¹Ÿæ˜¯ã€‚è§£å†³æ–¹æ¡ˆæ˜¯æ¨èå†™ç²¾ç®€çš„ scriptï¼Œæ¯”å¦‚ä¸€ä¸ª script åªå¹²ä¸€ä»¶äº‹ã€‚æˆ–è€…å¾ˆé•¿å¾ˆå¤æ‚çš„è¯ä½ å°±éœ€è¦ä¸“é—¨æ”¾åˆ°ä¸€ä¸ª JS æ–‡ä»¶é‡Œç„¶åå†åœ¨ npm scripts é‡Œè°ƒç”¨äº†ã€‚</p>\n<h2 id=\"span-nswatch-span\"><span>nswatch</span></h2>\n<blockquote>\n<p><a href=\"https://github.com/egoist/nswatch\" target=\"_blank\" rel=\"external\">https://github.com/egoist/nswatch</a></p>\n</blockquote>\n<p>åœ¨ npm scripts é‡Œåªæ‰§è¡Œä¸€ä¸ªæ„å»ºä»»åŠ¡ä½ å¯èƒ½ä¸éœ€è¦ç±»ä¼¼ <code>gulp.watch</code> è¿™æ ·çš„åŠŸèƒ½ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ„å»ºå·¥å…·éƒ½è‡ªå¸¦äº† watch åŠŸèƒ½ï¼Œæ¯”å¦‚ <code>webpack --watch</code> å’Œ <code>rollup --watch</code>ï¼Œä½†æ˜¯æ’é™¤è¿™ç§æƒ…å†µåœ¨æ„å»ºå¤šä¸ªä»»åŠ¡çš„æ—¶å€™å°±ä¸æ–¹ä¾¿äº†ã€‚</p>\n<p>æ¯”å¦‚ä½ è¦åŒæ—¶ç”¨ä¸€äº› <code>.jade</code> <code>.css</code> <code>.js</code> è¿™äº›æ–‡ä»¶åˆ†åˆ«ç¼–è¯‘æˆ <code>.html</code> <code>.css</code> <code>.js</code> æ–‡ä»¶ï¼Œå¼€å‘çš„æ—¶å€™æ€ä¹ˆæå•Šï¼Œæ€ä¹ˆ watch è¿™äº›æ–‡ä»¶ç„¶åæ‰§è¡Œ rebuild å‘¢ï¼Ÿå¥½å§ï¼Œä½ åˆæƒ³åˆ°äº† <code>gulp</code> ğŸ˜‚</p>\n<p>ä¸è¿‡ç°åœ¨æœ‰ <code>nswatch</code> äº†ï¼Œä¸ºäº†è§£å†³ç±»ä¼¼çš„éœ€æ±‚æˆ‘ä»Šæ—©æ´—æ¾¡ä¹‹åå†™çš„ã€‚å’Œ <code>gulp.watch</code> ç±»ä¼¼ï¼Œç›‘å¬ä¸€äº›æ–‡ä»¶ï¼Œä¸è¿‡è¿™é‡Œæ˜¯æ‰§è¡Œç›¸åº”çš„ npm scriptã€‚</p>\n<p>ä½ çš„ npm scripts:</p>\n<pre><code class=\"language-JSON\">{\n  &quot;scripts&quot;: {\n    &quot;build:js&quot;: &quot;node scripts/build js&quot;,\n    &quot;build:html&quot;: &quot;node script/build html&quot;,\n    &quot;build:css&quot;: &quot;node scripts/build css&quot;\n  }\n}\n</code></pre>\n<p>ç„¶åä½ å¯ä»¥åœ¨ <code>scripts/build.js</code> é‡Œç”¨ä½ å–œæ¬¢çš„ npm åŒ…ï¼Œæ¯”å¦‚ rollup, jade, postcssï¼Œæ¥ç¼–è¯‘ç›¸åº”æ–‡ä»¶ã€‚</p>\n<p>æœ€åæ·»åŠ  <code>nswatch</code>:</p>\n<pre><code class=\"language-JSON\">{\n  &quot;scripts&quot;: {\n    &quot;watch&quot;: &quot;nswatch src/*.js --script build:js &amp; nswatch src/*.css --script build:css  &amp; nswatch src/*.jade --script build:html &quot;\n  }\n}\n</code></pre>\n<p>ç”±äºæœ‰ä¸‰ä¸ªä»»åŠ¡æ‰€ä»¥å†™å¾—å¾ˆé•¿ï¼Œä½ å¯ä»¥æŠŠå®ƒæ”¾è¿›å•ç‹¬æ–‡ä»¶ <code>scripts/watch.js</code>:</p>\n<pre><code class=\"language-JavaScript\">const watch = require('nswatch')\n\nwatch('./src/*.js', ['build:js'])\nwatch('./src/*.jade', ['build:html'])\nwatch('./src/*.css', ['build:css'])\n</code></pre>\n<p>ç„¶åæ‰§è¡Œ <code>node scripts/watch</code> ä¸€åˆ‡éƒ½èƒ½è¿è¡Œäº†ï¼</p>\n<p>æœ€åä½ å¯èƒ½è¿˜æ˜¯éœ€è¦æŠŠ <code>node scripts/watch</code> å†™è¿› <code>package.json</code>ï¼Œä»¥åéƒ½ç”¨ <code>npm run watch</code> æ¥æ‰§è¡Œ:</p>\n<pre><code class=\"language-JSON\">{\n  &quot;scripts&quot;: {\n    &quot;watch&quot;: &quot;node scripts/watch&quot;\n  }\n}\n</code></pre>\n"}