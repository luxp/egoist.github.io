<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>ç”¨ npm scripts å’Œ nswatch æ›¿ä»£ gulp</title><link rel="alternate" type="application/rss+xml" title="åº¶æ°‘æ ·æœ¬" href="/atom.xml"><link href="/css/main.css?v=4.3.1" rel="stylesheet"><link rel="stylesheet" href="/css/highlight.css?v=4.3.1"><link rel="stylesheet" href="/css/zoom.css?v=4.3.1"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@rem_rin_rin"><meta name="twitter:title" content="ç”¨ npm scripts å’Œ nswatch æ›¿ä»£ gulp"><meta name="description" content="Long live gulp, I use npm script"><meta name="twitter:description" content="Long live gulp, I use npm script"></head><body><header class="header"><h1 class="site-name"><a href="/">e.z.</a></h1><ul class="nav"><li><a href="/about.html">about</a></li><li><a href="/girls.html">girls</a></li><li><a href="/donate.html">donate</a></li></ul></header><section class="centered post-page"><article class="post"><h2 class="post-title">ç”¨ npm scripts å’Œ nswatch æ›¿ä»£ gulp</h2><h2 class="post-subtitle">Long live gulp, I use npm script</h2><script></script><div class="post-content markdown-body"><h2 id="span-ä¸ºä»€ä¹ˆç”¨-npm-scripts-span"><span>ä¸ºä»€ä¹ˆç”¨ npm scripts ?</span></h2>
<p>é¦–å…ˆæˆ‘è§‰å¾—  <a href="https://medium.freecodecamp.com/why-i-left-gulp-and-grunt-for-npm-scripts-3d6853dd22b8#.8wsejnq0u" target="_blank" rel="external">Why I Left Gulp and Grunt for npm Scripts</a> é‡Œè¯´çš„ä¸ç”¨ gulp çš„ç†ç”±åŸºæœ¬æ²¡æœ‰é“ç†:</p>
<ol>
<li>gulp æ’ä»¶è´¨é‡ã€æ•°é‡å’Œå®æ—¶æ€§</li>
</ol>
<p>ä½œè€…æŠ±æ€¨ gulp æ’ä»¶çš„è´¨é‡å–å†³äºæ’ä»¶ä½œè€…ï¼Œè¿™å¯ä»¥ç†è§£ï¼Œ<strong>ä½†æ˜¯ npm çš„åŒ…åŒæ ·å–å†³äºä½œè€…å•Š</strong>ã€‚</p>
<p>ä½œè€…æŠ±æ€¨ gulp æ’ä»¶çš„æ•°é‡ä¸å¦‚ npmï¼Œ<strong>è¿™ä¸æ˜¯åºŸè¯å—</strong>ã€‚</p>
<p>ä½œè€…æŠ±æ€¨ gulp æ’ä»¶ä¸èƒ½åŠæ—¶æ›´æ–°ï¼Œæ¯”å¦‚ babel 6 å‡çº§äº† gulp-babel å¹¶æ²¡æœ‰ç«‹åˆ»å‡çº§ã€‚<strong>åˆä¸æ˜¯çœ‹ç›´æ’­ï¼Œå¹²å˜›å®æ—¶?</strong></p>
<ol start="2">
<li>debug å¾ˆç—›è‹¦ï¼Œgulp crash æ‰æ˜¯å› ä¸ºæŸä¸ªæ’ä»¶å—è¿˜æ˜¯å› ä¸ºç‰ˆæœ¬é—®é¢˜</li>
</ol>
<p>é¢ï¼Œéš¾é“ç›´æ¥ç”¨ npm package å°±æ²¡æœ‰è¿™äº›é—®é¢˜å—ã€‚</p>
<ol start="3">
<li>ä¸è¿è´¯çš„æ–‡æ¡£ï¼Œæ¯”å¦‚ gulp-eslint å’Œ eslintï¼Œeslint çš„æ–‡æ¡£å°±æ˜¯ gulp æ’ä»¶çš„æ–‡æ¡£å¥½å¾—å¤š</li>
</ol>
<p>è¿™ä¸åˆæ˜¯åºŸè¯å—ï¼Œå†™ä¸ªæ’ä»¶è¿˜è¦æŠŠç”¨çš„åŒ…çš„æ–‡æ¡£é‡æ–°å†™ä¸€é?</p>
<hr>
<p>å¥½äº†ï¼ŒåŸæ–‡æŒ‘å‰” gulp çš„ç†ç”±å…¨è¢«æ‰³å€’äº†ï¼Œä½†æ˜¯å…¶ä¸­æ”¯æŒ npm çš„ç†ç”±å€’æ˜¯æŒºæœ‰é“ç†:</p>
<ol>
<li>npm scripts å¹¶ä¸éœ€è¦ä½ å¾ˆæ“…é•¿å‘½ä»¤è¡Œæ“ä½œ</li>
</ol>
<p>ä½ å¹¶ä¸éœ€è¦åœ¨ npm scripts é‡Œç”¨ä¸€äº›å¾ˆé«˜æ·±çš„å‘½ä»¤è¡Œï¼Œå¾ˆå¤š unix å‘½ä»¤æ˜¯éœ€è¦èŠ±å¾ˆé•¿æ—¶é—´å­¦ä¹ çš„ã€‚åƒç±»ä¼¼ rm -rf ä¹‹ç±»çš„å‘½ä»¤å¾ˆå®¹æ˜“æŒæ¡ï¼Œè€Œä¸”ä¹Ÿæœ‰ç›¸åº”çš„ npm åŒ… <a href="https://github.com/isaacs/rimraf" target="_blank" rel="external">rimraf</a> è®©ä½ ä½¿ç”¨ï¼Œä¸”è·¨å¹³å°æ”¯æŒã€‚</p>
<ol start="2">
<li>npm scripts ä¸å¤Ÿå¼ºå¤§å—?</li>
</ol>
<pre><code class="language-JSON">{
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rimraf ./dist &amp;&amp; mkdir dist&quot;,
    &quot;prebuild&quot;: &quot;npm run clean&quot;,
    &quot;build&quot;: &quot;cross-env NODE_ENV=production webpack&quot;
  }
}
</code></pre>
<p>npm scripts ç”šè‡³æ”¯æŒ <code>pre</code> <code>post</code> è¿™äº› hook è®©ä½ åœ¨ç›¸åº”çš„ä¸€ä¸ª task ä¹‹å‰å’Œä¹‹åè°ƒç”¨ã€‚</p>
<p>ä½ å¯ä»¥ç›´æ¥æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶æ¥å®Œæˆç›¸åº”çš„æ„å»ºå·¥ä½œï¼Œè¿™è®©ä½ å‡ ä¹èƒ½åšä»»ä½• gulp èƒ½åšçš„äº‹:</p>
<pre><code class="language-JSON">{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;node build.js&quot;
  }
}
</code></pre>
<ol start="3">
<li>npm scripts ä¸æ˜¯è·¨å¹³å°çš„</li>
</ol>
<p>å› ä¸ºä½ å¯èƒ½ä¼šåœ¨ npm scripts é‡Œç”¨ä¸€äº› unix å‘½ä»¤ï¼Œè§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ç”¨ npm åŒ…æ›¿ä»£è¿™äº›å‘½ä»¤ã€‚</p>
<ol start="4">
<li>å¯ç»´æŠ¤æ€§</li>
</ol>
<p>gulp tasks ä¹Ÿå¤šäº†ä»¥åä¼šå˜å¾—å¾ˆéš¾ç»´æŠ¤ï¼Œnpm scripts ä¹Ÿæ˜¯ã€‚è§£å†³æ–¹æ¡ˆæ˜¯æ¨èå†™ç²¾ç®€çš„ scriptï¼Œæ¯”å¦‚ä¸€ä¸ª script åªå¹²ä¸€ä»¶äº‹ã€‚æˆ–è€…å¾ˆé•¿å¾ˆå¤æ‚çš„è¯ä½ å°±éœ€è¦ä¸“é—¨æ”¾åˆ°ä¸€ä¸ª JS æ–‡ä»¶é‡Œç„¶åå†åœ¨ npm scripts é‡Œè°ƒç”¨äº†ã€‚</p>
<h2 id="span-nswatch-span"><span>nswatch</span></h2>
<blockquote>
<p><a href="https://github.com/egoist/nswatch" target="_blank" rel="external">https://github.com/egoist/nswatch</a></p>
</blockquote>
<p>åœ¨ npm scripts é‡Œåªæ‰§è¡Œä¸€ä¸ªæ„å»ºä»»åŠ¡ä½ å¯èƒ½ä¸éœ€è¦ç±»ä¼¼ <code>gulp.watch</code> è¿™æ ·çš„åŠŸèƒ½ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ„å»ºå·¥å…·éƒ½è‡ªå¸¦äº† watch åŠŸèƒ½ï¼Œæ¯”å¦‚ <code>webpack --watch</code> å’Œ <code>rollup --watch</code>ï¼Œä½†æ˜¯æ’é™¤è¿™ç§æƒ…å†µåœ¨æ„å»ºå¤šä¸ªä»»åŠ¡çš„æ—¶å€™å°±ä¸æ–¹ä¾¿äº†ã€‚</p>
<p>æ¯”å¦‚ä½ è¦åŒæ—¶ç”¨ä¸€äº› <code>.jade</code> <code>.css</code> <code>.js</code> è¿™äº›æ–‡ä»¶åˆ†åˆ«ç¼–è¯‘æˆ <code>.html</code> <code>.css</code> <code>.js</code> æ–‡ä»¶ï¼Œå¼€å‘çš„æ—¶å€™æ€ä¹ˆæå•Šï¼Œæ€ä¹ˆ watch è¿™äº›æ–‡ä»¶ç„¶åæ‰§è¡Œ rebuild å‘¢ï¼Ÿå¥½å§ï¼Œä½ åˆæƒ³åˆ°äº† <code>gulp</code> ğŸ˜‚</p>
<p>ä¸è¿‡ç°åœ¨æœ‰ <code>nswatch</code> äº†ï¼Œä¸ºäº†è§£å†³ç±»ä¼¼çš„éœ€æ±‚æˆ‘ä»Šæ—©æ´—æ¾¡ä¹‹åå†™çš„ã€‚å’Œ <code>gulp.watch</code> ç±»ä¼¼ï¼Œç›‘å¬ä¸€äº›æ–‡ä»¶ï¼Œä¸è¿‡è¿™é‡Œæ˜¯æ‰§è¡Œç›¸åº”çš„ npm scriptã€‚</p>
<p>ä½ çš„ npm scripts:</p>
<pre><code class="language-JSON">{
  &quot;scripts&quot;: {
    &quot;build:js&quot;: &quot;node scripts/build js&quot;,
    &quot;build:html&quot;: &quot;node script/build html&quot;,
    &quot;build:css&quot;: &quot;node scripts/build css&quot;
  }
}
</code></pre>
<p>ç„¶åä½ å¯ä»¥åœ¨ <code>scripts/build.js</code> é‡Œç”¨ä½ å–œæ¬¢çš„ npm åŒ…ï¼Œæ¯”å¦‚ rollup, jade, postcssï¼Œæ¥ç¼–è¯‘ç›¸åº”æ–‡ä»¶ã€‚</p>
<p>æœ€åæ·»åŠ  <code>nswatch</code>:</p>
<pre><code class="language-JSON">{
  &quot;scripts&quot;: {
    &quot;watch&quot;: &quot;nswatch src/*.js --script build:js &amp; nswatch src/*.css --script build:css  &amp; nswatch src/*.jade --script build:html &quot;
  }
}
</code></pre>
<p>ç”±äºæœ‰ä¸‰ä¸ªä»»åŠ¡æ‰€ä»¥å†™å¾—å¾ˆé•¿ï¼Œä½ å¯ä»¥æŠŠå®ƒæ”¾è¿›å•ç‹¬æ–‡ä»¶ <code>scripts/watch.js</code>:</p>
<pre><code class="language-JavaScript">const watch = require('nswatch')

watch('./src/*.js', ['build:js'])
watch('./src/*.jade', ['build:html'])
watch('./src/*.css', ['build:css'])
</code></pre>
<p>ç„¶åæ‰§è¡Œ <code>node scripts/watch</code> ä¸€åˆ‡éƒ½èƒ½è¿è¡Œäº†ï¼</p>
<p>æœ€åä½ å¯èƒ½è¿˜æ˜¯éœ€è¦æŠŠ <code>node scripts/watch</code> å†™è¿› <code>package.json</code>ï¼Œä»¥åéƒ½ç”¨ <code>npm run watch</code> æ¥æ‰§è¡Œ:</p>
<pre><code class="language-JSON">{
  &quot;scripts&quot;: {
    &quot;watch&quot;: &quot;node scripts/watch&quot;
  }
}
</code></pre>
</div><div id="disqus_thread" class="disqus"></div><script>window.isPost = true;
var disqus_config = function () {
  this.page.url = 'https://egoistian.com/2016/08/29/kill-gulp-with-npm-scripts-and-nswatch/'; // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = '2016/08/29/kill-gulp-with-npm-scripts-and-nswatch/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};</script><noscript>Please enable JavaScript to view the<a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><div class="post-report-bug">æ–‡ç« å‹˜è¯¯å¯ä»¥ç›´æ¥åˆ° <a target="_blank" href="https://github.com/egoist/blog/blob/master/source/_posts/kill-gulp-with-npm-scripts-and-nswatch.md">æºä»£ç åœ°å€</a> ä¿®æ”¹æˆ–è€… <a target="_blank" href="https://github.com/egoist/blog/issues/new">æäº¤ ISSUE</a>ï¼Œæ„Ÿè°¢é˜…è¯»ï¼</div></article></section><footer class="footer"><div class="centered"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" class="hide-on-mobile">CC BY-NC-ND 4.0</a><span class="hide-on-mobile">&nbsp;</span><span>&copy;&nbsp;</span><a href="https://github.com/egoist">E.Z.</a><span class="hide-on-mobile">&nbsp;</span><a href="https://github.com/egoist/blog" class="hide-on-mobile">Read the source code.</a></div></footer><div style="display:none"></div><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-54857209-6', 'auto');
ga('send', 'pageview');</script><script async src="https://www.google-analytics.com/analytics.js"></script><script src="/js/highlight.min.js?v=4.3.1"></script><script src="/js/zoom.js?v=4.3.1"></script><script>window.hexoLayout = "post"</script><script src="/js/app.js?v=4.3.1"></script></body></html>